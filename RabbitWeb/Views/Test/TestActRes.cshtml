
@{
    Layout = null;
}
<script src="~/Scripts/jquery-3.6.0.min.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />


<div class="container" style="margin-top:3%">
    
    <table id="mytable" class="table table-striped">
        <thead>
            <tr>
                <th>Client No</th>
                <th>GUID</th>
                <th>Publish Time</th>
            </tr>
        </thead>
        <tbody id="SetClientList">
            <tr id="LoadingStatus" style="color:red"></tr>
        </tbody>
    </table>
</div>

<script>
    $("#LoadingStatus").html("Loading....");
    $.get("/Test/GetClientList", null, DataBind);
    function DataBind(ClientList) {
        $('#mytable tr:not(:first)').remove();
        var SetData = $("#SetClientList");
        var table = document.getElementById("mytable");
      
        for (var i = 0; i <= ClientList.length; i++) {
            var currentRow = table.rows[i];
            var createClickHandler = function (row) {
                return function () {
                    var cell = row.getElementsByTagName("td")[1];
                    var id = cell.textContent;
                    alert("id:" + id);
                    var f = {};
                    f.url = '@Url.Action("GetClientList","ClientChart")';
                    f.type = "POST";
                    f.dataType = "json";
                    f.data = JSON.stringify({ GuidInCome: id });
                    f.contentType = "application/json";
                    f.success = function (response) {
                       // alert("successed");
                        window.location.pathname = "ClientChart/ClientChartActRes";
                    };
                    f.fail = function (response) {
                        alert("failed");
                    };
                    $.ajax(f);
                };
            };
            currentRow.onclick = createClickHandler(currentRow);
            var date = new Date(parseInt(ClientList[i].PublishTime.substr(6)));
            var Data = "<tr class='row_" + ClientList[i].Guid + "'>" +
                "<td>" + i + "</td>" +
                "<td>" + ClientList[i].Guid + "</td>" +
                "<td>" + date + "</td>" +
                
                "</tr>";
            SetData.append(Data);
            $("#LoadingStatus").html(" ");

        }
    }
    $(document).ready(function () {
        var intervalId = setInterval(function () {


            $.get("/Test/GetClientList", null, DataBind);
            DataBind(ClientList);

        }, 5000);

    });


</script>
